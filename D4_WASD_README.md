# D4_WASD 使用說明 :

![D4_WASD](https://www.web3d.url.tw/images/d4wasd/D4_WASD_LOGO.png)
[觀看 D4_WASD 使用說明影片](https://www.youtube.com/watch?v=1Nr_NjOGMdw)

## 一. 編寫 D4 WASD 的動機 :

最近在巴哈姆特的暗黑破壞神四哈拉板看到網友提問：是否能在 PC 版上使用 WASD 操作角色移動，同時又可以使用滑鼠指向攻擊目標。

這是一個非常有趣且具有挑戰性的問題，因為暗黑破壞神 PC 版的預設操作模式是使用滑鼠左鍵作為角色移動和互動的按鍵，而滑鼠右鍵則用來施放技能。因此這個需求似乎有些難以實現。

為了解決這個問題，我想到了一個主意：編寫一個把按鍵輸入模擬出接近 "使用 WASD 操作角色移動同時可以用滑鼠指向攻擊目標" 的小程式，於是，D4 WASD 成為了現實。

-----

## 二. 下載及執行 D4 WASD 的步驟如下：

1. 開啟您的網頁瀏覽器，輸入 https://www.web3d.url.tw/tmp/d4wasd.zip 下載該檔案。若您遇到瀏覽器封鎖的問題，請參考 附圖A 及 附圖B 的解決方法。
2. 下載完成後，將 d4wasd.zip 壓縮檔解壓縮到您的桌面。解壓縮後會得到一個 D4_WASD 資料夾，其中包含主程式 D4_WASD.exe 及設定檔 wasd_setting.txt。
3. 用滑鼠點擊 D4_WASD.exe 執行主程式。

* [附圖A](https://www.web3d.url.tw/images/d4wasd/download_d4wasd_from_chrome.png)
* [附圖B](https://www.web3d.url.tw/images/d4wasd/download_d4wasd_from_edge.png)


-----

## 三. D4 WASD 基本功能介紹 :

D4 WASD 預設的上、左、下、右按鍵對應 "wasd" 鍵，強制移動對應 "0" 鍵，滑鼠左右鍵為 "5,6"。在使用 D4 WASD 前，建請先進入你要玩的遊戲中的按鍵設定，把可能會衝突到的鍵位改設其它鍵，例如遊戲預設用s鍵作為技能設定選單，把它改設為f5，d鍵是顯示玩家血量，把它改設為f6，強制移動鍵設為 "0"。

在遊戲中設定好按鍵後，再執行 D4 WASD，按一下 "w" 鍵，角色就會向上移動一個小單位，表示程式成功運作！

除了預設的 wasd 及滑鼠左右鍵及強制移動對應鍵外，D4 WASD 還有其他預設功能鍵。以下是簡單的介紹：

1. 結束程式：同時按下 "Shift + Alt + X"。
2. 隱藏程式：同時按下 "Shift + Alt + H"。
3. 顯示程式：同時按下 "Shift + Alt + S"。
4. 暫停或啟用：按 "-" 鍵。
5. 切換角色移動後的動作：按 "+" 鍵。
6. 切換角色移動後游標是否復位：按 "|" 鍵。

在遊戲過程中，偶爾會需要暫停程式的運作，例如回村整理裝備或打字聊天時，可能會不小心按到 wasd 或方向鍵選字等按鍵，這時可以按一下 "-" 鍵，程式即暫停運作。當準備好要打怪時，再次按下 "-" 鍵讓程式啟用，即可繼續使用 wasd 控制角色移動。若需要結束程式，只需按住 "Shift + Alt + X" 即可。

-----

## 四.修改設定檔 :

D4 WASD 主程式執行時預設會載入 "wasd_setting.txt"，我們可以用純文字編輯器來修改內容，讓按鍵設定符合你的遊戲需求(例如把 上左下右 的按鍵對應從 "wasd" 改成 "方向鍵的上左下右"，或是要設定只在特定視窗為前景時程式才會有作用等等)，修改完成後請以 unicode 檔案格式存檔。推薦使用 Notepad++ 來編輯設定檔，與 Notepad++ 軟體相關的資訊請自行搜尋Google。

以上面舉的例子來作示範，首先我們對 "wasd_setting.txt" 檔案按右鍵，選擇 "Edit with Notepad ++"，在檔案中找到 `ACTIVE_WIN_TITLE = ""` 這一行， 將它改成 `ACTIVE_WIN_TITLE="暗黑破壞神III"`，接著找到 `"UP":"w", "DOWN":"s", "LEFT":"a", "RIGHT":"d",` 這幾行，將它們改成 `"UP":"up", "DOWN":"down", "LEFT":"left", "RIGHT":"right",` 修改時請特別小心，只能改到雙引號包含的內容，不要破壞現有的架構，以免造成程式無法正常運作，全部修改完成後按儲存(Ctrl+S)即完成設定檔修改。

設定檔修改完成後，重新執行 D4 WASD 主程式，它就會套用我們剛才修改的設定，你會發現原本按 wasd 控制角色移動，現在變成要按方向鍵來控制了，並且程式只會在「暗黑破壞神III」視窗取得焦點時運作，以避免誤控到其他視窗或桌面。

-----

## 五. 使用D4 WASD搭配滑鼠時需要注意的事項：

當我開始撰寫 D4 WASD 時，原先的想法是製作一個可以不必握滑鼠也可以玩遊戲的程式。從先前的測試影片中可以看到，我是用右手按方向鍵來控制角色移動，而左手則繼續操作鍵盤的按鍵。雖然這樣的操作方式可以運作，但是看到網友問能否使用WASD搭配滑鼠放技能，才發現我的方向有些走偏。
 
先前談到寫這個程式的動機時，有稍微提到暗黑遊戲的角色移動機制是以滑鼠左鍵點擊地板位置，角色就會自動移到點的地方，我的解決方式是依照按的方向，控制滑鼠從視窗中心點往按的方向位移一小單位再點地板(或按強制移動鍵)，這會產生一個問題就是，當你按 wasd 控制角色移動後滑鼠的位置已經從原本位置(例如右下角)移到中心點附近，如果在角色移動後要讓滑鼠復位到原本位置需要做一些計算，幸運的是這部份的算法已經寫好了，預設的 "游標復位:True"，就是這個功能。(要切換游標復位 Ture 或 False ，可按快捷鍵 "|" )
 
需要注意的是，雖然算法可能沒什麼問題，但是在使用時還是要避免右手移動滑鼠時同時按角色移動鍵。因為角色移動的邏輯無其它解，當角色移動同時滑鼠也在移動時，就會造成非預期的情況。所以，請先按W讓角色向上移動，接著放開W，這時滑鼠會復位到原本的位置，再開始控制滑鼠位置及右鍵施法。可能需要練習一些時間才能熟悉此操作。
 
總而言之，我的結論是：暗黑破壞神四 PC版 支援手把，最好還是使用手把操作，讓遊戲體驗更加順暢，如果堅持要使用 WASD 玩的話，可以參考我寫的這個小程式。


-----

## 六. 尚未解決的BUG說明 :

若頻繁的同時使用滑鼠及角色移動鍵，有時會遇到角色不受控的往某一方向移動，像是按鍵卡住一樣，例如一直往上跑，就算你的一雙手都離開鍵鼠，它仍然自顧自的往上跑，這個BUG還需要一些時間解決，若遇到這個BUG時可以試試下列方式排除：
1. 依它跑的方向按同方向鍵的角色移動鍵幾下，例如一直往上跑就按往上一兩下，按完就放開。
2. 或按 Ctrl + Alt + X 結束程式再重啟。

-----

## 七. 免責聲明 :

1. 本程式僅提供使用者進行測試學習之用，並不對使用者的行為負責，也不對使用者所儲存的資料內容負責。
2. 使用者使用本程式的風險由使用者自行承擔。對於因使用者違反相關法律法規而引起的任何損失或損害，本服務不承擔任何責任。

